.status-top
  %span.history-button.position-absolute
    %a{href: '/history'} View Historical Data
  - if is_admin? @user
    %span.admin-button
      = link_to "Admin", controller: :main, action: :admin
  .text-center
    %h1.mb-0
      Course Data API Status
    %h6.mb-3
      %i.font-weight-light#update-request
        Tests run every five minutes.
        = link_to "Run now.", controller: :main, action: :run_update_job
    %div{class: "alert alert-#{overall_status @results} m-auto d-inline-block"}
      = MainController.status_map[overall_status @results]
.container-fluid#api-status-content
  .notice
    - unless flash[:notice].nil?
      .alert.alert-info.mx-auto.mb-2
        = flash[:notice]
    - active_notices.each do |notice|
      %div{class: "alert alert-#{notice.severity} mx-auto mb-2"}
        %h5.alert-heading= notice.title
        = notice.content
  .card-columns
    - @results.each do |path, test_results|
      .card
        .card-body
          %h5.card-title
            %span{class: "badge badge-pill badge-#{main_dot_type(test_results)}"} &nbsp;
            &nbsp;
            =MainController.name_map[path]
          %h6.card-subtitle.text-muted
            =path
        %ul.list-group.list-group-flush
          - test_results.each do |test_name, results|
            %li.list-group-item
              %span{class: "badge badge-pill badge-#{individual_dot_type(results)}"} &nbsp;
              &nbsp;
              - if is_admin? @user
                = link_to test_name, controller: :main, action: :view_results, id: @ids[path][test_name]
              - else
                = test_name
              %p.text-muted.mb-0= results[:message]
        - unless @time_diff.nil?
          .card-footer.text-muted{style: "font-size: 11.5px;"}
            Last updated
            =@time_diff
            ago
    .card
      .card-body
        %h5.card-title
          %span{class: "badge badge-pill badge-#{@data["status"]}"} &nbsp;
          &nbsp;Data Age
      %ul.list-group.list-group-flush
        %li.list-group-item
          %span{class: "badge badge-pill badge-#{@data["status"]}"} &nbsp;
          &nbsp;
          = @data["current"]
      - unless @time_diff.nil?
        .card-footer.text-muted{style: "font-size: 11.5px;"}
          Last updated
          =@time_diff
          ago
%footer
  .text-center
    Contact
    %a{href: "mailto:asg-technology@u.northwestern.edu"} asg-technology@u.northwestern.edu
    with any concerns.
